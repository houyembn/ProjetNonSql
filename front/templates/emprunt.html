<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoSQL Project</title>
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
	<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />


    <!-- Link to the CSS file -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    {% include 'shared.html' %}
    <section id="content">
		<main>
			<div class="table-data">
				<div class="form-container">
					<div class="head">
						<h3>Formulaire</h3>
					</div>
					<form id="empruntForm" action="/addemprunts" method="POST">
						<div class="form-group">
							<label for="reference">Réference de l'emprunt</label>
							<input 
								type="text" 
								id="reference" 
								placeholder="Reference" 
								name="reference" 
								required 
								maxlength="5"
								oninput="validateReference(this)"
							>
							<small id="referenceError" style="color: red; display: none;">La référence doit être un entier de 5 chiffres.</small>
						</div>
						
						<script>
							function validateReference(input) {
								const regex = /^\d{1,5}$/; // Seulement des chiffres avec un maximum de 5
								const errorElement = document.getElementById('referenceError');
						
								if (!regex.test(input.value)) {
									errorElement.style.display = 'block';
								} else {
									errorElement.style.display = 'none';
								}
						
								// Empêche la saisie si le texte ne correspond pas
								input.value = input.value.replace(/[^\d]/g, '').slice(0, 5);
							}
						</script>
						
						<div class="form-group">
							<label for="abonne">Choisissez un abonné :</label>
							<select id="abonne" name="abonne" required>
								<option value="" disabled selected>Sélectionnez un abonné</option>
								{% for abonne in abonnes %}
									<option value="{{ abonne.nom }} {{ abonne.prenom }}">{{ abonne.nom }} {{ abonne.prenom }}</option>
								{% endfor %}
							</select>
						</div>
						
					
						<div class="form-group">
							<label for="documentemprunte">Document Emprunté</label>
							<select id="documentemprunte" name="documentemprunte" required>
								<option value="" disabled selected>Sélectionnez un document</option>
								{% for document in documents %}
									{% if document.disponibilite == 'oui' %}
										<option value="{{ document.titre }}">{{ document.titre }}</option>
									{% endif %}
								{% endfor %}
							</select>
						</div>
						
						<div class="form-group">
							<label for="datedemprunt">Date d'emprunt</label>
							<input type="date" id="datedemprunt"  name="datedemprunt">
						</div>
						<div class="form-group">
							<label for="datederetour">Date de retour prévue</label>
							<input type="date" id="datederetour"  name="datederetour">
						</div>
						<div class="form-group">
							<label for="statusemprunt">Statut de l'emprunt</label>
							<select id="statusemprunt" name="statusemprunt" required>
								<option value="Terminé">Terminé</option>
								<option value="Retardé">Retardé</option>
								<option value="Annulé">Annulé</option>
							</select>
						</div>						
						<input type="hidden" name="idEmprunt" value="idEmprunt">
						<button type="submit">Ajouter</button>
					</form>
				</div>
				
					

				
				<!-- <div class="todo">
					<div class="head">
						<h3>Todos</h3>
						<i class='bx bx-plus' ></i>
						<i class='bx bx-filter' ></i>
					</div>
					<ul class="todo-list">
						<li class="completed">
							<p>Todo List</p>
							<i class='bx bx-dots-vertical-rounded' ></i>
						</li>
						<li class="completed">
							<p>Todo List</p>
							<i class='bx bx-dots-vertical-rounded' ></i>
						</li>
						<li class="not-completed">
							<p>Todo List</p>
							<i class='bx bx-dots-vertical-rounded' ></i>
						</li>
						<li class="completed">
							<p>Todo List</p>
							<i class='bx bx-dots-vertical-rounded' ></i>
						</li>
						<li class="not-completed">
							<p>Todo List</p>
							<i class='bx bx-dots-vertical-rounded' ></i>
						</li>
					</ul>
                </div> -->
			</div>
        </main>
    </section>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script>
		function confirmDeletion(reference) {
		  Swal.fire({
			title: 'Êtes-vous sûr ?',
			text: "Cette action est irréversible !",
			icon: 'warning',
			showCancelButton: true,
			confirmButtonColor: '#d33',
			cancelButtonColor: '#3085d6',
			confirmButtonText: 'Oui, supprimer',
			cancelButtonText: 'Annuler'
		  }).then((result) => {
			if (result.isConfirmed) {
			  document.getElementById(`deleteForm-${reference}`).submit();
			}
		  });
		}
	  </script>
	  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	  <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
	  <script>
		$(document).ready(function() {
			// Initialize Select2 for the abonne dropdown
			$('#abonne').select2({
				placeholder: "Choisissez un abonné",
				allowClear: true
			});
	
			// Initialize Select2 for the documentemprunte dropdown
			$('#documentemprunte').select2({
				placeholder: "Sélectionnez un document",
				allowClear: true
			});
		});
	</script>
	
		  
</body>
</html>
