!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookUp</title>
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
	  <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAA7VBMVEX////m8/8hJXxKpf8AAHACDXXu+/8eIns/of/c6ffv/f8uMoFLqf/S6P8KEXYfHXbr9v+dnsE2Z70zXrObpco8oP9Kpv/u+P8fG3UsMILd7/8XG3jb7f/C4P8SFncACHRttf9+vf+v1v9lsv+52/+n0f/w8Pecy/+Rx/8dEnCDhLGGwP/K5P9drf9Fl+82OYUrSJzl5e8/QolmaKCSlLrJ1eqxu9mztM1FSpE/hNskLobExNhwcqXMzd67xuLX1+ZQVpZyeqxWXJtBi+MuUaUoPZI5c8mtrsiYoce2wd1ITY9dZJ+nsdKHj7p+gK2OxXanAAAQFElEQVR4nO2dCXeaShvHXwRErSBNgyagbJJqoyRt1MQmNtFszaL5/h/nnRlE2Ten19t75n/OPbe1wn9+wCzPzCPzv/8RERERERERERERERERERERERERERERERERERERERH9Z/Xj7ub3+GN0/za9OIe6mL7djz7Gv2/uvmJ0+bp1gTYXf8Yl5HrzeXYusJrGqqrSaHCuGg1FVeHHwvns882uJdi6CKqieFwUnC5h21+fRyVGExSulCROETSmNPr8q1gBsrswO7hE+Y7vS0yarb8Ayv04r39Bl93xrmbXqRc1wr8haMejq6yQX29mx0VcFIHN4RKJ985ouX23/hpzn8H+69VoR5d5UchxiVEiTskpKmgIGFBfQEugwJrHoFahEVFIRRNmN4kmNwtFi3JpbFygibpx4SJcGowyLsD340ILnIzjVFDFlels9bK8nEyqriaTy8OX1WyqMAyrBjk5hbn4/CPO4/MFE7x7XENl41zGpyPoIqhBTk67iPOIByz5rix45AXl4uPwtkqJrXKrJfrVAp+JVPV2+TEFdSNQaE5gZ3cRFnczVgh8U2EFZfqxTHE5XFzA4viOVUp5Ec8Vj68gnI8OJ1QNGiQJFKtGTZazCzVAqTDz4MN6M2cC15BVL2bLrC63h6NzH6VykQ9wrG2O1JT3lwmVZusrAKAccYzK+RjfvIw3b34+heHgNczlIk9e3j2VWMtXFxnnqIbGzC6rYmbfrX+r+roQfJWsoU1dxpup1vDePUZbvFZb+V3KYvVywbrnYvIAXjm3UJ1eUuW8vh7/1xnHelAazBusj3dTxvshy81exR1cqMupcx+1qxyEM3RMYyq2Chq79tXlnFW9jLO7mZdPZefLamE8Ry1xis6ozLKg/bganwIdo6dLe90N0LGfLARPk6l46h8nCIvJjhcRebyiR447hkUfXyU1qr/mqqZCOSViqrtdXEdiq7pShXBHzQnquJq77kU6VJ1mg0Nl19R57Gh1FhjDMFUM9hSqKy+f2EDXxx6/FK/jAa0Jt89JzPM6FwJXGRchULl6eOxh5ITrw2oZ29kDhKUSO48CHAUBcRJCxpXgtjmqsMLIF0FYEkZhwN+hb+ElBA1CdeHUAmW2a/MZUJiwxPwOEa4Hs2B0LbhtH2ZCSqw5JWFqWPk2hBws+rqV5EpBwKv1l7iPw8PDpdNb4CakymtCnE8olEPIHS9B2T/Wt4oJDoSdPp7jJmBI36p9+isJP9VA2csTBzHU/zt3jV0i87+WEJksWeeOBggFL1MiIYrUREqW20iyDMfZ8MP0kuQgdOLBgE2ci4/Q/ZsQIGQdbyqBEHpSfMc66Rt617bter3eBP/Zdlc3Bj2zw8uQdGdCSCbzHbM3QDYbF2jTP7E6PNUKgvoJKceFzUsoyp0Tw27SFSA6pAr6uK73TT7hdqYRwkN5s6/X1+eLtKGbtnHSkb0eWAhlXZKiPENFkCp6z2pTkZRJhOCAttXTKxldJF3GSyjq6b7bAkiVbr8jh0fVsYRiS+70u+C4HCb69vQ4CIc5vNeXua6bQchoQoBnGvUMty7gMMRJKHby+juUANLLGEUoUqaemw6dvbM5NY572PYVHFQDUOFhAwdbOvhURrYL6LsDT32JIJQHsUfCOk2jdnTtIvld2lifUrEnORW83gVNttkZ8jzso2TYXfH80DrpDXQ7spWodLd3MUwodiOOAOex9UHvxAq4dEzQUXXrTpMn9fDWQ0o09S5opNtOkx5sQ5yP5CFo6UOYUieBsCOF4Lp9cyi7pwy5gM/aoNvq6qbnXzH1h61QRxsWHO3wpmF7ISvbsoQIRdP7xYptgO40ZdTgkPqnHvEQZhco4/DEqLtNf6Z7WJGaxskw/8TsfggRpShbAxoWX9IT6yHqZyV6YMlZBrYx2gchhQYplkE3+56PonqLfpM2rOghUGbtiZByBtGp/WHacD2D9kcY1D8SHxJCJEJIrXvftTKXJD9hNhuchKizldt8p2OZJ0imZYExnJxpQJCV0OnSZTBO89h0OnxbjnbBRAjnMIZmDwwMm+uYfiswQLbBeLXTTr7WGQjhCcCwrG/Y9WbIBdh0jZ45pALNL55xKd8z6slhPgo5wKiSj+28UwjBMIE3YSCcalM3ejzmcaloZY2/QQGA/zAiwk8kBGHwEF7DrKFipWLhjS3kZjbjjX8dDKJDkHGEYqudP8pvbgPPPcX4lUoXPEo+yEhCEVSAboEoH3OMHyb0NgCxhZC6J20PYwSh2D7RkypAvE1lG7NgaWnqG0fQDtRt3TAGfaQBmrilg1MMm3LQVmJsYdGRR0EbGk01uzaGodt1byNkbwuHpaUZgugbtGF6H85ty/6uGIb3bdCRDCLnMSrb+hImlCOeDaliD0CX0I5wkXnQkeiwTZcqQ9yzGJRldqik9Qm0nMFb/W7TTylljfEhXbPbt1CYn+AC+uWOCQIuvPcQnTvGNFCCltzp6fVt3co4iwGifL0Hp5Ez2nj/9s+PvEHX3Rm4kNJ21i/8lLalNZ49gAOign57iS1AaYf9JmwxzMSWxoQtVLM/3CnK31v0JIqdnm90FdVb8L1eZ9cgf4/xoZipx985b4FEwIQQn/4WwnVW+VaZpzJyEeawwUaIHCmYRNAf6E6ygm13nTwFa9hOn8fIRohs2kPLyVXoIhcwRNUHfZgOQUXYYFqZgWs+AxiAh1cL0VqfJNlGz+STBj+phPBQ3uwZdoJLpTuAa2D4V2b6doZUhQocew1MmBCSmxCmsph9vZnJRbK9qwVYYouBlGLrLQBtG2Y7AjKeEEX5Np0jEJYGeGMLPmcMDh4oOxjhxxKK4rCXi86x4HESip3st3BbBKkOx5sphHD8Ws+TZuJKwjuL4buHlXWddxU/lQFihpMUwhM7Di/CxVcKrPeQEg2Jdqq4hJIITMtJVmjzw2EH5ikYzkRGxKU2tj83CBO2jIiHA01hdA2Yq+C68EM4+w3TIaS1jWTgjvH7zaYNmmk+vIrgfoISFZqh+iRtM3vChEMpCEc3dZiqEG/Dg07Lbjb7+DMVxHBOYFAoeTE4j5E9U0HazGGkuAAbEX9/mFlw4cEabGuXZCUQWtIGzx5Y7YKR1B5G3qCgfM+BrNQTY/x6xcHr8TtE+fvKVGgBSJrWt9M0UW1pW6dpgLfbr4P2manA86n9IR8aGOQWiQ8JIT79dYS5shSgihGm22AlXM8syG2YRgA1dNIUMuQp5CF0bGCygmuD0hRibLCtW4iUzMNfW9jNzUjYjbvhYNXsyCmrG1kI0RoT/LUFzMj1u0hNmA5h8XJwjhXPuFS2egZaPYuPBODq28Acxo9MUjMVxPbQHKDVsySbim30LBnzuFQcZozhKjBJv29FRfgpv7dota2+Xk9cU/aOYeu41w/r6a5eTLrbG4ZvZWymAozyuzmj/Dree5g/UwFECqG02Jh1C9kaNPNH+XjX8Qv+3kKqDzreaYyotSdqu9KYlxDrLIa8PTFq1ug6nKNF6trNihQ301ip2HxibMHbcQfCczY9LnVa8rVAePNpUE5UxQnAT6xh259CAMP7DpzHpSPbicR7GMUGZyNB37MN9N14vz0EnZXu5LtJmHOi4EpmH3R4sT27k0HAWz3QjQUyFTJFwC6crfcsPj4jwsmN7Jh97HltVMaVTJioAH9w4alZWWcxYJRv8tlSFf5Ej59HKMLvbn5vsZ31Cz+l/Ob3Ft0dovz9ZCq0ZFOnK6Do/cTZxD64EBU6/EO+XNpX9ARGKSeGYaX0FpZhnESPgLJrv5kKqbMYJFMhgwghIcQnQlhUhJAQ4hMhLCpCSAjxiRAWFSEkhPhECIuKEBJCfPo7CEVRLAPV4BtIq1X4Ct0a/Hum+aR8bxVstYBNDb4JVISvYQcmcTPuuAihZY2a3F6+nI7e584OMHADmPn77PTl8ha9Lz55WjDbWwWBi2OzWrzfI5/p2xtyGS9fJ1VIiu2tghP3ROhdkJPl6v5YFVhnA5iGZ5sZBX2qHN+vlreUGI+Z+lbBVlms3i5P3643NuudZhobF1WZLg5fq96XvogTh/A8B+EbegW4ukKHiGWqermaqwyrJm+0wSkqy2jTjyW40PlXucvl6uRwcR61hYTfBe1mcz0a31bXr3KvnaIXFDfm2QlbK+edxtpSrNWqt6dvqpbs6lVDZbXz0XIS8Sb5+LcKlqnJy/tx7n1mVrfwoV2u35G/amUmFG+dL5WEi9H8GFzTjLYef1a9OL0tByBj3ipYFl8X52qR3WxU9vh+MV2/xHpTqTIQUrVpwy1q5nsX8geP9eLV99uSqHWLFtreoPg+M6CmOn9qTNcPaSbCdd2NO2njCOjbEdI39H/Y8ER8VWE+nYLHNY5QbFGTDy5qN5sS57q4NmuX+GJpm3YxCyFVHkchctDp+vuXg+fnnw9nrh5+Ph8cPD5dg38Ll4BTtfmh+/puP6FYrr68aWrwEMCGXB5DLs8HX75Dl6MoTma8uZCZCEFjw3A+W3AFrx+ff57R6GWN9aZHdfQBTZ/9PHgsHYUwG4LyMUGMXkKxPFkoQqCGA7ij0uPBxiVkg1yeH6/BDfU9NByz2j762Qip2uXmRfiA7vr78wPtWEZlTjjJEagMAPOpFKAEVfL9FnRfW0JRfL33b9MC6UpPAC6TS+XhGdxO14Vjjy9rVF5C+LL/9fHfDyBdgmuwBGcPB0+BZ0lh7l8972R/De6jc3T0dPBwlsuFfjj4vvbwb0OQlRDcxgt0gqOzrL4ef/rs+fs3H6TCvt06HZd2O2e9fNzRt+/PZ3QBl7MjdPy05it3dsLyvbMZy5dcSW2uP7iVz0++1q/h7r7grX6gzXx6PkM1LLfqX5ztV+7LBQndoc3Rs1Ptc8vunh08Jfd03NPBWdcudvrmzyPngq1aBQk3veLR05eiOni8TiS8fjwofO4nB9ATIeQlpMqboU2jsNIGK7ufujENjHNzECYObf41Ct7CPIRUa7s72b9WzDi4n1IeQko8ZYqOif8ZccxpKEjLRUiVl0LEXk3/FnGCsAyH0/kIqVZ1dc5qrFBQGYpZ9NSgVBerasSWXzkJUfx9eVhQL+mIwkvRk19OovfEyktIOe8DLiYxvTFmip88ZsYrmXDnLDr/paEyEP4hzxhCHrcyEP4hzyCh02B+2/7OCJO+pRJ+w20pIU9ODRCeO4HSc5EwIkkZCDE71p+dkOo8QPjhhBGNh2LD/NjhfwbCgoFLnB6csbT6ESC8WVeYxuMBVqVPtTbwGj66AUdoL+lP7pxH8bF+lFIBASJWuRjBh3R7E/8jCt9CUBPZfZcKo9hgLUQa/XfuIhOxhSXUmAlNQP+N4lQmdgPrH4uSphUd6sdJTSyOittO00qLpB2Bv/66+oxZ44QYmmNWuO2ufn1N4PszuhKiFpeglFxbaf+L9eOeURUuKEVl3pMep79Ld+P5+bFf5/Px3b6LhVlf/dp3cYiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiI/kL9H5sR3XstdGaGAAAAAElFTkSuQmCC" type="image/x-icon">

    <!-- Link to the CSS file -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    {% include 'shared.html' %}
    <section id="content">
		<main>
			<div class="table-data">
                <div class="order">
					<div class="head">
						<h3>Liste des abonnés</h3>
						<div class="search-container">
							<!-- Search inputs and icon -->
							<div class="search-box">
								<input type="text" id="searchName" placeholder="Rechercher" onkeyup="filterTable()">
								<input type="date" id="searchDate" onchange="filterTable()">
								<i class='bx bx-search'></i>
							</div>
					
							<!-- <form action="{{ url_for('delete_all_abonnes') }}" method="post">
								<button type="submit" onclick="return confirm('Voulez-vous vraiment supprimer tous les abonnés ?')" class="delete-btn">
									Supprimer tous les abonnés
								</button>
							</form> -->
						</div>
					</div>
					
					<table id="abonneTable">
						<thead>
							<tr>
								<th>Prénom et Nom</th>
								<th>Email</th>
								<th>Adresse</th>
								<th>Date d'inscription</th>
                                <th>Mot de passe</th>
                                <!-- <th>Liste d'Emprunts</th>
                                <th>Historique d'Emprunts</th> -->
								<th>Order</th>
							</tr>
						</thead>
						<tbody>
                            {% for abonne in abonnes %}
							<tr>
								<td>
									<br>{{abonne.prenom}}</br> {{abonne.nom}}</p>
								</td>
								<td>{{abonne.email}}</td>
                                <td>{{abonne.adresse}}</td>
								<td>{{abonne.datedinscription}}</td>
                                <td>{{ '*' * abonne.motdepasse|length }}</td>
                                <!-- <td>{{abonne.listedemprunts}}</td>
                                <td>{{abonne.historiquedemprunts}}</td> -->
								<td>

						<!-- Delete Form -->
                        <form id="deleteForm-{{ abonne.email }}" action="/delete_abonne" method="POST" style="display:inline;">
                            <input type="hidden" name="email" value="{{ abonne.email }}">
                            <button
                                class="btn btn-danger btn-sm"
                                type="submit"
                                onclick="return confirm('Are you sure you want to delete this item?')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                        

<!-- Update Form -->
<form id="updateForm-{{ abonne.email }}" action="/update_abonne/{{ abonne.email }}" method="POST" style="display:inline;">
    <button 
        class="btn btn-success btn-sm" 
        type="button" 
        onclick="showUpdateForm('{{ abonne.id }}', '{{ abonne.nom }}', '{{ abonne.prenom }}', '{{ abonne.email }}', '{{ abonne.adresse }}', '{{ abonne.datedinscription }}', '{{ abonne.motdepasse }}')">
        <i class="fa fa-edit"></i>
    </button>
</form>
<!-- '{{ abonne.listedemprunts }}', '{{ abonne.historiquedemprunts }}' -->


								</td>
							</tr>
								<!-- <td><span class="status completed">Completed</span></td> -->
							</tr>
                            {% endfor %}
						</tbody>
					</table>
				</div>
				<!-- <div class="todo">
					<div class="head">
						<h3>Todos</h3>
						<i class='bx bx-plus' ></i>
						<i class='bx bx-filter' ></i>
					</div>
					<ul class="todo-list">
						<li class="completed">
							<p>Todo List</p>
							<i class='bx bx-dots-vertical-rounded' ></i>
						</li>
						<li class="completed">
							<p>Todo List</p>
							<i class='bx bx-dots-vertical-rounded' ></i>
						</li>
						<li class="not-completed">
							<p>Todo List</p>
							<i class='bx bx-dots-vertical-rounded' ></i>
						</li>
						<li class="completed">
							<p>Todo List</p>
							<i class='bx bx-dots-vertical-rounded' ></i>
						</li>
						<li class="not-completed">
							<p>Todo List</p>
							<i class='bx bx-dots-vertical-rounded' ></i>
						</li>
					</ul>
                </div> -->
			</div>
        </main>
    </section>

   <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
function showUpdateForm(id, nom, prenom, email, adresse, datedinscription, motdepasse) {
    let formattedDate = new Date(datedinscription).toISOString().split('T')[0];
    let maskedPassword = '*'.repeat(motdepasse.length);

    Swal.fire({
        title: '<h3 style="color: #3C91E6; margin-bottom: 20px;">Modifier Abonné</h3>',
        html: ` 
            <form id="swal-update-form" action="/update_abonne/${email}" method="POST" class="text-left">
                <div class="form-group mb-3">
                    <label for="nom">Nom</label>
                    <input type="text" name="nom" value="${nom}" class="form-control" placeholder="Nom" required>
                </div>
                <div class="form-group mb-3">
                    <label for="prenom">Prénom</label>
                    <input type="text" name="prenom" value="${prenom}" class="form-control" placeholder="Prénom" required>
                </div>
                <div class="form-group mb-3">
                    <label for="adresse">Adresse</label>
                    <input type="text" name="adresse" value="${adresse}" class="form-control" placeholder="Adresse" required>
                </div>
                <div class="form-group mb-3">
                    <label for="datedinscription">Date d'inscription</label>
                    <input type="date" name="datedinscription" value="${formattedDate}" class="form-control">
                </div>
                <div class="form-group mb-3">
    <label for="motdepasse">Mot de passe</label>
    <div class="d-flex align-items-center">
        <input type="password" id="password-field" name="motdepasse" value="${maskedPassword}" 
               class="form-control me-2" placeholder="Mot de passe" required>
        <button type="button" id="toggle-password-visibility" class="btn custom-button-color">
            <i class="fas fa-eye"></i>
        </button>
    </div>
</div>

                <div style="justify-content: center; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary">Mettre à jour</button>
                </div>
            </form>
        `,
        showConfirmButton: false,
        customClass: {
            popup: 'swal2-popup-custom',
        },
        showCloseButton: true,
        didOpen: () => {
            const toggleButton = document.getElementById('toggle-password-visibility');
            const passwordField = document.getElementById('password-field');
            let isMasked = true;

            toggleButton.addEventListener('click', () => {
                isMasked = !isMasked;
                passwordField.type = isMasked ? 'password' : 'text';
                toggleButton.innerHTML = `<i class="fas ${isMasked ? 'fa-eye' : 'fa-eye-slash'}"></i>`;
                if (isMasked) {
                    passwordField.value = '*'.repeat(motdepasse.length); // Reset to asterisks
                } else {
                    passwordField.value = motdepasse; // Show the actual password
                }
            });

            passwordField.addEventListener('focus', () => {
                if (isMasked) passwordField.value = '';
            });

            passwordField.addEventListener('blur', () => {
                if (isMasked && passwordField.value === '') passwordField.value = '*'.repeat(motdepasse.length);
            });
        },
    });
}


// <div class="form-group mb-3">
//                     <label for="listedemprunts">Liste d'Emprunts</label>
//                     <input type="text" name="listedemprunts" value="${listedemprunts}" class="form-control" placeholder="Liste d'Emprunts" required>
//                 </div>
//                 <div class="form-group mb-3">
//                     <label for="historiquedemprunts">Historique d'Emprunts</label>
//                     <input type="text" name="historiquedemprunts" value="${historiquedemprunts}" class="form-control" placeholder="Historique d'Emprunts" required>
//                 </div>






</script>


	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script>
		function confirmDeletion(email) {
		  Swal.fire({
			title: 'Êtes-vous sûr ?',
			text: "Cette action est irréversible !",
			icon: 'warning',
			showCancelButton: true,
			confirmButtonColor: '#d33',
			cancelButtonColor: '#3085d6',
			confirmButtonText: 'Oui, supprimer',
			cancelButtonText: 'Annuler'
		  }).then((result) => {
			if (result.isConfirmed) {
			  document.getElementById(`deleteForm-${email}`).submit();
			}
		  });
		}
	  </script>

<script>
    function filterTable() {
        const searchName = document.getElementById("searchName").value.toLowerCase();
        const searchDate = document.getElementById("searchDate").value;
        const table = document.getElementById("abonneTable");
        const rows = table.getElementsByTagName("tr");

        for (let i = 1; i < rows.length; i++) { // Start at 1 to skip header row
            const row = rows[i];
            
            const nameCell = row.cells[0].textContent.toLowerCase();
            const emailCell = row.cells[1].textContent.toLowerCase();
            const adresseCell = row.cells[2].textContent.toLowerCase();
            const dateCell = row.cells[3].textContent.trim();
            // const listedempruntsCell = row.cells[4].textContent.toLowerCase();
            // const historiquedempruntsCell = row.cells[5].textContent.toLowerCase();

            // Filter by name
            const matchesName = nameCell.includes(searchName);

            // Filter by email, adresse, listedemprunts, historiquedemprunts
            const matchesEmail = emailCell.includes(searchName);
            const matchesAdresse = adresseCell.includes(searchName);
            // const matchesListedemprunts = listedempruntsCell.includes(searchName);
            // const matchesHistoriquedemprunts = historiquedempruntsCell.includes(searchName);

            // Filter by date (if a date is provided in the search)
            const matchesDate = searchDate ? dateCell.includes(searchDate) : true;

            // Display or hide the row based on the filters
            if ((matchesName || matchesEmail || matchesAdresse ) && matchesDate) {    
                row.style.display = "";
            } else {
                row.style.display = "none";
            }
        }
    }
    // || matchesListedemprunts || matchesHistoriquedemprunts
</script>
	
</body>
</html>